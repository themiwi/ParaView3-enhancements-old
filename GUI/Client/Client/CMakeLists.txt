PROJECT(QtClient)

SET(QT_CLIENT_VERSION_MAJOR 0)
SET(QT_CLIENT_VERSION_MINOR 9)
SET(QT_CLIENT_VERSION_PATCH 0)
SET(QT_CLIENT_VERSION ${QT_CLIENT_VERSION_MAJOR}.${QT_CLIENT_VERSION_MINOR})

ADD_DEFINITIONS(-DVERSION=${QT_CLIENT_VERSION})

INCLUDE_DIRECTORIES(
  ${QtClient_BINARY_DIR}
  ${QtTesting_BINARY_DIR}
  ${QtTesting_SOURCE_DIR}
  ${QtWidgets_BINARY_DIR}
  ${QtWidgets_SOURCE_DIR}
  ${ParaQ_SOURCE_DIR}/ParaView/VTK/Imaging
)

QT4_WRAP_CPP(MOC_BUILT_SOURCES
  pqAboutDialog.h
  pqMainWindow.h
)

SET(UI_FORMS
  pqAbout.ui
)

QT4_WRAP_UI(UI_BUILT_SOURCES
  ${UI_FORMS}
)

SET(UI_RESOURCES
  pqClient.qrc
)

QT4_ADD_RESOURCES(RCS_SOURCES
  ${UI_RESOURCES}
)

SOURCE_GROUP("Resources" FILES
  ${UI_RESOURCES}
  ${UI_FORMS}
)

SOURCE_GROUP("Generated" FILES
  ${MOC_BUILT_SOURCES}
  ${RCS_SOURCES}
  ${UI_BUILT_SOURCES}
)

IF(WIN32)
  LINK_DIRECTORIES(${QT_LIBRARY_DIR})
ENDIF(WIN32)

ADD_EXECUTABLE(pqClient WIN32 MACOSX_BUNDLE
  main.cxx
  pqAboutDialog.cxx
  pqAboutDialog.h
  pqMainWindow.cxx
  pqMainWindow.h
  ${MOC_BUILT_SOURCES}
  ${RCS_SOURCES}
  ${UI_BUILT_SOURCES}
)

TARGET_LINK_LIBRARIES(pqClient
  QtWidgets
  QtTesting
)

IF(WIN32)
  TARGET_LINK_LIBRARIES(pqClient
    optimized qtmain debug qtmaind
  )
ENDIF(WIN32)

IF(BUILD_TESTING)
  SET(TEST_BINARY ${EXECUTABLE_OUTPUT_PATH}/pqClient)
  SET(TEST_XML ${QtClient_SOURCE_DIR}/Testing/XML)

  ADD_TEST(QtClientStartup        ${TEST_BINARY} --exit)
#  ADD_TEST(QtClientCreateSource   ${TEST_BINARY} --run-test ${TEST_XML}/CreateSource.xml --compare-view ${TEST_XML}/CreateSource.png)
ENDIF(BUILD_TESTING)

CONFIGURE_FILE(${QtClient_SOURCE_DIR}/pqConfig.h.in
               ${QtClient_BINARY_DIR}/pqConfig.h)

